'use strict';

var component = require('@loadable/component');
var $e = require('react');
var zod = require('zod');
var react = require('@iconify/react');
var jsxRuntime = require('react/jsx-runtime');

function _interopDefault (e) { return e && e.__esModule ? e : { default: e }; }

var component__default = /*#__PURE__*/_interopDefault(component);
var $e__default = /*#__PURE__*/_interopDefault($e);

function oe(e){switch(e){case"ZodString":return "string";case"ZodNumber":return "number";case"ZodBoolean":return "boolean";case"ZodDate":return "date";case"ZodNaN":return "nan";case"ZodLiteral":return "literal";case"ZodEnum":return "enum";case"ZodUnion":return "union";case"ZodAny":return "any";default:return "unknown"}}function j(e,o){var s;if(e.innerType){let t={...o};return e.typeName==="ZodOptional"&&(t.optional=!0),e.typeName==="ZodDefault"&&(t.defaultValue=e.defaultValue()),j(e.innerType._def,t)}if(e.typeName==="ZodArray")return j(e.type._def,{isArray:!0,...e.minLength&&{minLength:e.minLength},...e.maxLength&&{maxLength:e.maxLength},...e.exactLength&&{exactLength:e.exactLength}});let r=[];return (s=e.checks)==null||s.map(t=>(t.regex&&console.log("REGEX",t.regex.source,t.regex.toString(),new RegExp(String(t.regex))),r.push({...t,...t.regex&&{regex:t.regex.source,flags:`${t.regex.global?"g":""}${t.regex.ignoreCase?"i":""}${t.regex.multiline?"m":""}`}}))),{...o,type:oe(e.typeName),...(r==null?void 0:r.length)>0&&{checks:r},...e.typeName==="ZodLiteral"&&{value:e.value},...e.typeName==="ZodEnum"&&{values:e.values}}}function ne(e,o){let r={type:"",properties:{}};if(typeof e=="object"){r.type="object";let s=e.shape;Object.keys(s).map(t=>{let a=s[t]._def;a.errorMap&&console.log(a.errorMap);let c=j(a);r.properties[t]=c,o&&o[t]&&(r.properties[t].extend=o[t]),a.values&&(r.properties[t].values=a.values);});}return r}function C(e,o){return !e||!o?!1:e.x<o.x&&e.y<o.y&&e.x+e.width>o.x&&e.y+e.height>o.y}var Pe=20;function K(e,o,r){let s=r||Pe;if(!e||!o)return !1;let t=e.x-s<0?0:e.x-s,a=e.x+e.width+s,c=e.y-s<0?0:e.y-s,i=e.y+e.height+s;return t<o.x&&a>o.x&&c<o.y&&i>o.y}var T="ALLOW_NAVIGATE",f="DRAGGING",x="DROPPED",A="DELETE",L="EDIT",re="HANDSHAKE",$="COMPONENT_SELECTED",st=zod.z.enum([re,$,T,f,x,A,L]),se=zod.z.object({_action:zod.z.literal(T),isNavigateEnabled:zod.z.boolean()}),S=zod.z.object({_action:zod.z.literal(f),x:zod.z.number(),y:zod.z.number()}),B=zod.z.object({_action:zod.z.literal(x),x:zod.z.number(),y:zod.z.number(),component:zod.z.object({id:zod.z.string().cuid2(),component:zod.z.string(),data:zod.z.any()})}),ae=zod.z.object({_action:zod.z.literal(A),id:zod.z.string().cuid2()}),ie=zod.z.object({_action:zod.z.literal(L),id:zod.z.string().cuid2(),field:zod.z.string(),value:zod.z.any()}),be=zod.z.object({_action:zod.z.literal(re),location:zod.z.object({href:zod.z.string(),pathname:zod.z.string()})}),Ce=zod.z.object({_action:zod.z.literal($),id:zod.z.string().cuid2(),page:zod.z.string(),component:zod.z.string(),data:zod.z.any()}),Ne=zod.z.object({_action:zod.z.literal(f),x:zod.z.number(),y:zod.z.number()}),pe=zod.z.object({_action:zod.z.literal(x),page:zod.z.string(),component:zod.z.object({id:zod.z.string().cuid2(),component:zod.z.string(),data:zod.z.any()}),parentId:zod.z.union([zod.z.string().cuid2(),zod.z.null()]),pageId:zod.z.string().cuid2(),sort:zod.z.number()}),ce=zod.z.discriminatedUnion("_action",[be,Ce,pe]),de=zod.z.discriminatedUnion("_action",[Ne,pe]);var Y=process.env.NODE_ENV==="development"?"http://localhost:5909":"https://adaptive.io";function v(e,o,r,s){$e.useEffect(()=>(window.addEventListener("message",t),()=>window.removeEventListener("message",t)),(s==null?void 0:s.deps)||[]);function t(c){return a(c,e,o,r)}function a(c,i,m,d){if(!(c.origin!==Y&&c.origin!==(location==null?void 0:location.origin)&&c.origin!==(s==null?void 0:s.origin))&&m.includes(c.data._action))return d.parse(c.data),i(c)}}var le=$e.createContext({cms:void 0,isEditable:!1});function F({cms:e,editorOrigin:o="http://localhost:5909",children:r}){let[s,t]=$e.useState(!1);$e.useEffect(()=>{var c,i;window.self!==window.top&&((i=(c=document==null?void 0:document.location)==null?void 0:c.ancestorOrigins)!=null&&i.contains(o))&&t(!0);},[]);let a=$e.useMemo(()=>({isEditable:s,cms:e}),[e,s]);return jsxRuntime.jsx(le.Provider,{value:a,children:r})}var w=()=>$e.useContext(le);function N(e){let o=window.parent,r=ce.parse(e);return o.postMessage(r,Y)}function X(e){let o=window,r=de.parse(e);return o.postMessage(r,location==null?void 0:location.origin)}function O({isParentHovered:e,onDrop:o,parentId:r,pageId:s,sort:t}){let a=$e.useRef(null),[c,i]=$e.useState(!1),[m,d]=$e.useState(!1),[l,y]=$e.useState(!1);v(E,[f,x],zod.z.discriminatedUnion("_action",[S,B]));function E(u){var P,_;if(u.data._action===f){let b=(P=a==null?void 0:a.current)==null?void 0:P.getBoundingClientRect(),I=K(b,{x:u.data.x,y:u.data.y}),W=C(b,{x:u.data.x,y:u.data.y});i(!0),d(!!I),y(!!W);}if(u.data._action===x){let b=(_=a==null?void 0:a.current)==null?void 0:_.getBoundingClientRect(),I=C(b,{x:u.data.x,y:u.data.y});if(d(!1),i(!1),I)return o&&o({...u.data.component,parentId:r,sort:t}),N({_action:"DROPPED",page:window.location.pathname,component:u.data.component,parentId:r,pageId:s,sort:t})}}return jsxRuntime.jsx(jsxRuntime.Fragment,{children:jsxRuntime.jsx("div",{className:`contented-dropzone contented-dropzone parent-${r}`,ref:a,style:{height:m?"20px":"0px",display:c?"flex":"none",background:l?"#3b82f6":"#dbeafe",border:l?"1px solid #3b82f6":m?"1px dashed #3b82f6":"",color:l?"white":"#1e40af",alignItems:"center",justifyContent:"center",margin:"2px 0",borderRadius:"4px",overflow:"hidden",transition:"height, display",transitionDuration:"100ms",width:"100%",zIndex:"10"},children:r})})}function ue({index:e,content:o,isParentHovered:r,previousSortKey:s,nextSortKey:t,onDrop:a,pageId:c,parentId:i}){let{cms:m,isEditable:d}=w(),l=$e.useRef(null),y=m.components,[E,D]=$e.useState(!1),[u,P]=$e.useState(!1),[_,b]=$e.useState(!1),{component:I,data:W,children:z=[],id:Q}=o,[g,he]=$e.useState(W),[G,ee]=$e.useState(!1);$e.useEffect(()=>{let p=M=>{l.current&&!l.current.contains(M.target)&&(b(!1),ee(!1));};return document.addEventListener("click",p,!0),()=>{document.removeEventListener("click",p,!0);}},[]),v(_e,[f,L],zod.z.discriminatedUnion("_action",[S,ie]));function _e(p){var M;if(p.data._action===f){let k=(M=l==null?void 0:l.current)==null?void 0:M.getBoundingClientRect();D(C(k,{x:p.data.x,y:p.data.y})),P(K(k,{x:p.data.x,y:p.data.y},60));}p.data.id===Q&&p.data._action===L&&he(k=>({...k,[p.data.field]:p.data.value}));}let te=y[I].component;if(!d)return jsxRuntime.jsxs(te,{...g,children:[g==null?void 0:g.children,z&&jsxRuntime.jsx(Z,{data:z,isParentHovered:E,pageId:c,parentId:o.id})]});function ve(){return N({_action:$,page:window.location.href,id:Q,component:o.component,data:o.data})}let Me=o.sort-(o.sort-s)/2,De=o.sort+(t-o.sort)/2;return jsxRuntime.jsxs("div",{style:{position:"relative"},draggable:!0,onDrag:p=>{let M={x:p.pageX,y:p.pageY};return X({_action:f,...M})},onDrop:p=>{let M={x:p.pageX,y:p.pageY};return X({_action:x,id:g.id,...M})},children:[e===0&&jsxRuntime.jsx(O,{isParentHovered:r,onDrop:p=>a&&a(p,e),parentId:i||o.id,pageId:c,sort:Me}),jsxRuntime.jsxs("div",{ref:l,onMouseOver:p=>(p.stopPropagation(),D(!0)),onMouseOut:p=>(p.stopPropagation(),P(!1),D(!1)),onClick:p=>(p.stopPropagation(),b(!0),ve()),style:{position:"relative",userSelect:"none",border:`1px ${u?"dashed":"solid"} ${(E||_)&&!G?U:u?"rgba(255,255,255,0.2)":"rgb(0,0,0,0)"}`,transition:"all",transitionDuration:(E||_)&&!G?"150ms":"250ms"},children:[(E||_)&&!G&&jsxRuntime.jsxs("div",{style:{position:"absolute",top:"-25px",left:"5px",borderRadius:"4px",background:U,color:"white",padding:"1px 4px",fontSize:"9pt",fontFamily:"sans-serif",display:"flex",gap:"1rem"},children:[jsxRuntime.jsx("div",{style:{color:"rgba(255,255,255,0.9)"},children:I}),_&&jsxRuntime.jsx("button",{type:"button",onClick:p=>(p.stopPropagation(),ee(!0)),children:"Edit"})]}),jsxRuntime.jsx("div",{children:jsxRuntime.jsx(te,{...g,children:z&&typeof(g==null?void 0:g.children)!="string"?jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[g==null?void 0:g.children,jsxRuntime.jsx(Z,{data:z,isParentHovered:E,pageId:c,parentId:o.id})]}):g==null?void 0:g.children})}),_&&!G&&jsxRuntime.jsx("button",{type:"button",style:{background:U,borderRadius:"50%",padding:"4px",position:"absolute",bottom:"-15px",right:"10px"},onClick:()=>{console.log("add sibling");},children:jsxRuntime.jsx(react.Icon,{icon:"md:add"})})]}),jsxRuntime.jsx(O,{isParentHovered:r,onDrop:p=>a&&a(p),parentId:i||o.id,pageId:c,sort:De})]})}function me(e){return e.sort((o,r)=>o.sort>r.sort?1:-1)}function Z({data:e,isParentHovered:o,pageId:r,parentId:s}){let[t,a]=$e.useState(me(e));v(c,[A],ae,{deps:[t]});function c(i){if(i.data._action===A&&(console.log(i.data,t),t.findIndex(d=>d.id===i.data.id)!==-1))return a(d=>[...d.filter(y=>y.id!==i.data.id)])}return jsxRuntime.jsx(jsxRuntime.Fragment,{children:Array.isArray(t)&&(t==null?void 0:t.length)>0?t.map((i,m)=>{var y,E;let d=((y=t[m-1])==null?void 0:y.sort)||i.sort-1e3,l=((E=t[m+1])==null?void 0:E.sort)||i.sort+1e3;return jsxRuntime.jsx($e__default.default.Fragment,{children:jsxRuntime.jsx(ue,{index:m,content:i,isParentHovered:o,previousSortKey:d,nextSortKey:l,pageId:r,parentId:s,onDrop:(D,u)=>a(P=>(console.log(D),[...me([...P,D])]))})},i.id)}):(t==null?void 0:t.length)>0?t:jsxRuntime.jsx(O,{isParentHovered:o,pageId:r,parentId:s,sort:0,onDrop:i=>(console.log(i),a([i]))})})}var U="dodgerblue";function ye({data:e}){let{isEditable:o}=w(),r=e.children,[s,t]=$e.useState(!1),[a,c]=$e.useState(!1),i=$e.useRef(null);$e.useEffect(()=>N({_action:"HANDSHAKE",location:{href:window.location.href,pathname:window.location.pathname}}),[]),v(m,[T,f,x],zod.z.discriminatedUnion("_action",[se,S,B]));function m(d){var l;if(d.data._action===T&&t(d.data.isNavigateEnabled),d.data._action===f){let y=(l=i==null?void 0:i.current)==null?void 0:l.getBoundingClientRect();c(C(y,{x:d.data.x,y:d.data.y}));}d.data._action===x&&c(!1);}return console.log(e),jsxRuntime.jsx($e.Suspense,{fallback:"Loading...",children:jsxRuntime.jsxs("div",{ref:i,className:"__adaptivecms__","data-adaptivecms":"page",children:[r&&jsxRuntime.jsx(Z,{data:r,pageId:e.id,parentId:null}),jsxRuntime.jsx("style",{type:"text/css",children:s||!o?"":`
            .__adaptivecms__ a {
              pointer-events:none;
            }
          `})]})})}var xe="sk_skr5pte9guegsgk2u7bw92uq";var Ee=class{constructor(o){this.secretApiKey="";this.publicApiKey="";this.components={};this.getPageData=async o=>{let r=new URL(o.url).pathname,s=await fetch(`https://worker.ds-media.workers.dev/?url=${encodeURIComponent(r)}`,{headers:{authorization:`Bearer ${this.publicApiKey}`}}).then(t=>t.status===200?t.json():new Response(null,{status:t.status,statusText:t.statusText}));if(s.status===404)throw new Response(null,{status:s.status,statusText:s.statusText});return s.pageData};if(!o)throw new Error("[CONTENTED] Missing variable: PUBLIC_API_KEY");this.secretApiKey=xe+"",this.publicApiKey=o+"";}define(o,r){let{name:s,deprecated:t=!1,...a}=r;return this.components[s]={component:o,...a},r.schema}sync(){var r;let o=[];(r=Object.keys(this.components))==null||r.map(s=>{let t=this.components[s];o.push({name:s,icon:t==null?void 0:t.icon,schema:ne(t.schema,t.extend),group:t.group});});}};

Object.defineProperty(exports, 'loadable', {
          enumerable: true,
          get: function () { return component__default.default; }
});
exports.ALLOW_NAVIGATE = T;
exports.C = Ee;
exports.COMPONENT_SELECTED = $;
exports.ContentedProvider = F;
exports.DELETE = A;
exports.DRAGGING = f;
exports.DROPPED = x;
exports.EDIT = L;
exports.EventActions = st;
exports.HANDSHAKE = re;
exports.MessageEvent_AllowNavigate = se;
exports.MessageEvent_Delete = ae;
exports.MessageEvent_Dragging = S;
exports.MessageEvent_Dropped = B;
exports.MessageEvent_Edit = ie;
exports.Page = ye;
exports.PostMessageSchema = ce;
exports.PostMessageSchema_Self = de;
exports.PostMessage_ComponentSelected = Ce;
exports.PostMessage_Dragging = Ne;
exports.PostMessage_Dropped = pe;
exports.PostMessage_Handshake = be;
exports.postMessage = N;
exports.useContented = w;
exports.useListener = v;
