import { useEffect, useRef, useState } from 'react';
import { z as z$1 } from 'zod';
import { jsx, Fragment } from 'react/jsx-runtime';

function M(t,n){return !t||!n?!1:t.x<n.x&&t.y<n.y&&t.x+t.width>n.x&&t.y+t.height>n.y}var C=20;function v(t,n,o){let s=o||C;if(!t||!n)return !1;let c=t.x-s<0?0:t.x-s,r=t.x+t.width+s,a=t.y-s<0?0:t.y-s,g=t.y+t.height+s;return c<n.x&&r>n.x&&a<n.y&&g>n.y}var P="ALLOW_NAVIGATE",p="DRAGGING",d="DROPPED",S="DELETE",I="EDIT",N="HANDSHAKE",A="COMPONENT_SELECTED",J=z$1.enum([N,A,P,p,d,S,I]),Q=z$1.object({_action:z$1.literal(P),isNavigateEnabled:z$1.boolean()}),b=z$1.object({_action:z$1.literal(p),x:z$1.number(),y:z$1.number()}),w=z$1.object({_action:z$1.literal(d),x:z$1.number(),y:z$1.number(),component:z$1.object({id:z$1.string().cuid2(),component:z$1.string(),data:z$1.any()})}),X=z$1.object({_action:z$1.literal(S),id:z$1.string().cuid2()}),Y=z$1.object({_action:z$1.literal(I),id:z$1.string().cuid2(),field:z$1.string(),value:z$1.any()}),k=z$1.object({_action:z$1.literal(N),location:z$1.object({href:z$1.string(),pathname:z$1.string()})}),W=z$1.object({_action:z$1.literal(A),id:z$1.string().cuid2(),page:z$1.string(),component:z$1.string(),data:z$1.any()}),Z=z$1.object({_action:z$1.literal(p),x:z$1.number(),y:z$1.number()}),O=z$1.object({_action:z$1.literal(d),page:z$1.string(),component:z$1.object({id:z$1.string().cuid2(),component:z$1.string(),data:z$1.any()}),parentId:z$1.union([z$1.string().cuid2(),z$1.null()]),pageId:z$1.string().cuid2(),sort:z$1.number()}),z=z$1.discriminatedUnion("_action",[k,W,O]),L=z$1.discriminatedUnion("_action",[Z,O]);var _="http://localhost:5909";function R(t,n,o,s){useEffect(()=>(window.addEventListener("message",c),()=>window.removeEventListener("message",c)),(s==null?void 0:s.deps)||[]);function c(a){return r(a,t,n,o)}function r(a,g,l,f){if(!(a.origin!==_&&a.origin!==(location==null?void 0:location.origin)&&a.origin!==(s==null?void 0:s.origin))&&l.includes(a.data._action))return f.parse(a.data),g(a)}}function T(t){let n=window.parent,o=z.parse(t);return n.postMessage(o,_)}function ae(t){let n=window,o=L.parse(t);return n.postMessage(o,location==null?void 0:location.origin)}function me({isParentHovered:t,onDrop:n,parentId:o,pageId:s,sort:c}){let r=useRef(null),[a,g]=useState(!1),[l,f]=useState(!1),[x,u]=useState(!1);R(G,[p,d],z$1.discriminatedUnion("_action",[b,w]));function G(i){var h,D;if(i.data._action===p){let m=(h=r==null?void 0:r.current)==null?void 0:h.getBoundingClientRect(),E=v(m,{x:i.data.x,y:i.data.y}),j=M(m,{x:i.data.x,y:i.data.y});g(!0),f(!!E),u(!!j);}if(i.data._action===d){let m=(D=r==null?void 0:r.current)==null?void 0:D.getBoundingClientRect(),E=M(m,{x:i.data.x,y:i.data.y});if(f(!1),g(!1),E)return n&&n({...i.data.component,parentId:o,sort:c}),T({_action:"DROPPED",page:window.location.pathname,component:i.data.component,parentId:o,pageId:s,sort:c})}}return jsx(Fragment,{children:jsx("div",{className:`contented-dropzone contented-dropzone parent-${o}`,ref:r,style:{height:l?"20px":"0px",display:a?"flex":"none",background:x?"#3b82f6":"#dbeafe",border:x?"1px solid #3b82f6":l?"1px dashed #3b82f6":"",color:x?"white":"#1e40af",alignItems:"center",justifyContent:"center",margin:"2px 0",borderRadius:"4px",overflow:"hidden",transition:"height, display",transitionDuration:"100ms",width:"100%",zIndex:"10"},children:o})})}

export { M as a, v as b, P as c, p as d, d as e, S as f, I as g, N as h, A as i, J as j, Q as k, b as l, w as m, X as n, Y as o, k as p, W as q, Z as r, O as s, z as t, L as u, R as v, T as w, ae as x, me as y };
