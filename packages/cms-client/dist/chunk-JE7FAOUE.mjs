import { b } from './chunk-Z3ZE4HI6.mjs';
import { v, f, n, y, w, c, d, e, k, l, m, a, g, o, b as b$1, x, i } from './chunk-V4AK5RMP.mjs';
import dt, { useState, useRef, useEffect, Suspense } from 'react';
import { Icon } from '@iconify/react';
import { jsx, Fragment, jsxs } from 'react/jsx-runtime';
import { z } from 'zod';

function j(i){return i.sort((o,d)=>o.sort>d.sort?1:-1)}function I({data:i,isParentHovered:o,pageId:d,parentId:y$1}){let[n$1,p]=useState(j(i));v(c,[f],n,{deps:[n$1]});function c(e){if(e.data._action===f&&(console.log(e.data,n$1),n$1.findIndex(r=>r.id===e.data.id)!==-1))return p(r=>[...r.filter(f=>f.id!==e.data.id)])}return jsx(Fragment,{children:Array.isArray(n$1)&&(n$1==null?void 0:n$1.length)>0?n$1.map((e,u)=>{var f,m;let r=((f=n$1[u-1])==null?void 0:f.sort)||e.sort-1e3,s=((m=n$1[u+1])==null?void 0:m.sort)||e.sort+1e3;return jsx(dt.Fragment,{children:jsx(tt,{index:u,content:e,isParentHovered:o,previousSortKey:r,nextSortKey:s,pageId:d,parentId:y$1,onDrop:(E,w)=>p(C=>(console.log(E),[...j([...C,E])]))})},e.id)}):(n$1==null?void 0:n$1.length)>0?n$1:jsx(y,{isParentHovered:o,pageId:d,parentId:y$1,sort:0,onDrop:e=>(console.log(e),p([e]))})})}var R="dodgerblue";function Tt({data:i}){let{isEditable:o}=b(),d$1=i.children,[y,n]=useState(!1),[p,c$1]=useState(!1),e$1=useRef(null);useEffect(()=>w({_action:"HANDSHAKE",location:{href:window.location.href,pathname:window.location.pathname}}),[]),v(u,[c,d,e],z.discriminatedUnion("_action",[k,l,m]));function u(r){var s;if(r.data._action===c&&n(r.data.isNavigateEnabled),r.data._action===d){let f=(s=e$1==null?void 0:e$1.current)==null?void 0:s.getBoundingClientRect();c$1(a(f,{x:r.data.x,y:r.data.y}));}r.data._action===e&&c$1(!1);}return console.log(i),jsx(Suspense,{fallback:"Loading...",children:jsxs("div",{ref:e$1,className:"__adaptivecms__","data-adaptivecms":"page",children:[d$1&&jsx(I,{data:d$1,pageId:i.id,parentId:null}),jsx("style",{type:"text/css",children:y||!o?"":`
            .__adaptivecms__ a {
              pointer-events:none;
            }
          `})]})})}function tt({index:i$1,content:o$1,isParentHovered:d$1,previousSortKey:y$1,nextSortKey:n,onDrop:p,pageId:c,parentId:e}){let{cms:u,isEditable:r}=b(),s=useRef(null),f=u.components,[m,E]=useState(!1),[w$1,C]=useState(!1),[v$1,K]=useState(!1),{component:z$1,data:ot,children:D=[],id:F}=o$1,[a$1,nt]=useState(ot),[M,Z]=useState(!1);useEffect(()=>{let t=x=>{s.current&&!s.current.contains(x.target)&&(K(!1),Z(!1));};return document.addEventListener("click",t,!0),()=>{document.removeEventListener("click",t,!0);}},[]),v(rt,[d,g],z.discriminatedUnion("_action",[l,o]));function rt(t){var x;if(t.data._action===d){let S=(x=s==null?void 0:s.current)==null?void 0:x.getBoundingClientRect();E(a(S,{x:t.data.x,y:t.data.y})),C(b$1(S,{x:t.data.x,y:t.data.y},60));}t.data.id===F&&t.data._action===g&&nt(S=>({...S,[t.data.field]:t.data.value}));}let U=f[z$1].component;if(!r)return jsxs(U,{...a$1,children:[a$1==null?void 0:a$1.children,D&&jsx(I,{data:D,isParentHovered:m,pageId:c,parentId:o$1.id})]});function at(){return w({_action:i,page:window.location.href,id:F,component:o$1.component,data:o$1.data})}let st=o$1.sort-(o$1.sort-y$1)/2,it=o$1.sort+(n-o$1.sort)/2;return jsxs("div",{style:{position:"relative"},draggable:!0,onDrag:t=>{let x$1={x:t.pageX,y:t.pageY};return x({_action:d,...x$1})},children:[i$1===0&&jsx(y,{isParentHovered:d$1,onDrop:t=>p&&p(t,i$1),parentId:e||o$1.id,pageId:c,sort:st}),jsxs("div",{ref:s,onMouseOver:t=>(t.stopPropagation(),E(!0)),onMouseOut:t=>(t.stopPropagation(),C(!1),E(!1)),onClick:t=>(t.stopPropagation(),K(!0),at()),style:{position:"relative",userSelect:"none",border:`1px ${w$1?"dashed":"solid"} ${(m||v$1)&&!M?R:w$1?"rgba(255,255,255,0.2)":"rgb(0,0,0,0)"}`,transition:"all",transitionDuration:(m||v$1)&&!M?"150ms":"250ms"},children:[(m||v$1)&&!M&&jsxs("div",{style:{position:"absolute",top:"-25px",left:"5px",borderRadius:"4px",background:R,color:"white",padding:"1px 4px",fontSize:"9pt",fontFamily:"sans-serif",display:"flex",gap:"1rem"},children:[jsx("div",{style:{color:"rgba(255,255,255,0.9)"},children:z$1}),v$1&&jsx("button",{type:"button",onClick:t=>(t.stopPropagation(),Z(!0)),children:"Edit"})]}),jsx("div",{children:jsx(U,{...a$1,children:D&&typeof(a$1==null?void 0:a$1.children)!="string"?jsxs(Fragment,{children:[a$1==null?void 0:a$1.children,jsx(I,{data:D,isParentHovered:m,pageId:c,parentId:o$1.id})]}):a$1==null?void 0:a$1.children})}),v$1&&!M&&jsx("button",{type:"button",style:{background:R,borderRadius:"50%",padding:"4px",position:"absolute",bottom:"-15px",right:"10px"},onClick:()=>{console.log("add sibling");},children:jsx(Icon,{icon:"md:add"})})]}),jsx(y,{isParentHovered:d$1,onDrop:t=>p&&p(t),parentId:e||o$1.id,pageId:c,sort:it})]})}

export { tt as a, I as b, R as c, Tt as d };
