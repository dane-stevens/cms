export { default as loadable } from '@loadable/component';
import $e, { createContext, useEffect, useState, useMemo, useContext, useRef, Suspense } from 'react';
import { z } from 'zod';
import { Icon } from '@iconify/react';
import { jsx, jsxs, Fragment } from 'react/jsx-runtime';

function te(e){switch(e){case"ZodString":return "string";case"ZodNumber":return "number";case"ZodBoolean":return "boolean";case"ZodDate":return "date";case"ZodNaN":return "nan";case"ZodLiteral":return "literal";case"ZodEnum":return "enum";case"ZodUnion":return "union";case"ZodAny":return "any";default:return "unknown"}}function j(e,o){var s;if(e.innerType){let t={...o};return e.typeName==="ZodOptional"&&(t.optional=!0),e.typeName==="ZodDefault"&&(t.defaultValue=e.defaultValue()),j(e.innerType._def,t)}if(e.typeName==="ZodArray")return j(e.type._def,{isArray:!0,...e.minLength&&{minLength:e.minLength},...e.maxLength&&{maxLength:e.maxLength},...e.exactLength&&{exactLength:e.exactLength}});let r=[];return (s=e.checks)==null||s.map(t=>(t.regex&&console.log("REGEX",t.regex.source,t.regex.toString(),new RegExp(String(t.regex))),r.push({...t,...t.regex&&{regex:t.regex.source,flags:`${t.regex.global?"g":""}${t.regex.ignoreCase?"i":""}${t.regex.multiline?"m":""}`}}))),{...o,type:te(e.typeName),...(r==null?void 0:r.length)>0&&{checks:r},...e.typeName==="ZodLiteral"&&{value:e.value},...e.typeName==="ZodEnum"&&{values:e.values}}}function oe(e,o){let r={type:"",properties:{}};if(typeof e=="object"){r.type="object";let s=e.shape;Object.keys(s).map(t=>{let a=s[t]._def;a.errorMap&&console.log(a.errorMap);let p=j(a);r.properties[t]=p,o&&o[t]&&(r.properties[t].extend=o[t]),a.values&&(r.properties[t].values=a.values);});}return r}function b(e,o){return !e||!o?!1:e.x<o.x&&e.y<o.y&&e.x+e.width>o.x&&e.y+e.height>o.y}var Pe=20;function K(e,o,r){let s=r||Pe;if(!e||!o)return !1;let t=e.x-s<0?0:e.x-s,a=e.x+e.width+s,p=e.y-s<0?0:e.y-s,i=e.y+e.height+s;return t<o.x&&a>o.x&&p<o.y&&i>o.y}var T="ALLOW_NAVIGATE",f="DRAGGING",_="DROPPED",A="DELETE",L="EDIT",ne="HANDSHAKE",$="COMPONENT_SELECTED",st=z.enum([ne,$,T,f,_,A,L]),re=z.object({_action:z.literal(T),isNavigateEnabled:z.boolean()}),S=z.object({_action:z.literal(f),x:z.number(),y:z.number()}),B=z.object({_action:z.literal(_),x:z.number(),y:z.number(),component:z.object({id:z.string().cuid2(),component:z.string(),data:z.any()})}),se=z.object({_action:z.literal(A),id:z.string().cuid2()}),ae=z.object({_action:z.literal(L),id:z.string().cuid2(),field:z.string(),value:z.any()}),be=z.object({_action:z.literal(ne),location:z.object({href:z.string(),pathname:z.string()})}),Ce=z.object({_action:z.literal($),id:z.string().cuid2(),page:z.string(),component:z.string(),data:z.any()}),Ne=z.object({_action:z.literal(f),x:z.number(),y:z.number()}),ie=z.object({_action:z.literal(_),page:z.string(),component:z.object({id:z.string().cuid2(),component:z.string(),data:z.any()}),parentId:z.union([z.string().cuid2(),z.null()]),pageId:z.string().cuid2(),sort:z.number()}),pe=z.discriminatedUnion("_action",[be,Ce,ie]),ce=z.discriminatedUnion("_action",[Ne,ie]);var Y="http://localhost:5909";function v(e,o,r,s){useEffect(()=>(window.addEventListener("message",t),()=>window.removeEventListener("message",t)),(s==null?void 0:s.deps)||[]);function t(p){return a(p,e,o,r)}function a(p,i,m,d){if(!(p.origin!==Y&&p.origin!==(location==null?void 0:location.origin)&&p.origin!==(s==null?void 0:s.origin))&&m.includes(p.data._action))return d.parse(p.data),i(p)}}var de=createContext({cms:void 0,isEditable:!1});function F({cms:e,editorOrigin:o="http://localhost:5909",children:r}){let[s,t]=useState(!1);useEffect(()=>{var p,i;window.self!==window.top&&((i=(p=document==null?void 0:document.location)==null?void 0:p.ancestorOrigins)!=null&&i.contains(o))&&t(!0);},[]);let a=useMemo(()=>({isEditable:s,cms:e}),[e,s]);return jsx(de.Provider,{value:a,children:r})}var w=()=>useContext(de);function C(e){let o=window.parent,r=pe.parse(e);return o.postMessage(r,Y)}function le(e){let o=window,r=ce.parse(e);return o.postMessage(r,location==null?void 0:location.origin)}function O({isParentHovered:e,onDrop:o,parentId:r,pageId:s,sort:t}){let a=useRef(null),[p,i]=useState(!1),[m,d]=useState(!1),[l,y]=useState(!1);v(x,[f,_],z.discriminatedUnion("_action",[S,B]));function x(g){var D,h;if(g.data._action===f){let P=(D=a==null?void 0:a.current)==null?void 0:D.getBoundingClientRect(),N=K(P,{x:g.data.x,y:g.data.y}),W=b(P,{x:g.data.x,y:g.data.y});i(!0),d(!!N),y(!!W);}if(g.data._action===_){let P=(h=a==null?void 0:a.current)==null?void 0:h.getBoundingClientRect(),N=b(P,{x:g.data.x,y:g.data.y});if(d(!1),i(!1),N)return o&&o({...g.data.component,parentId:r,sort:t}),C({_action:"DROPPED",page:window.location.pathname,component:g.data.component,parentId:r,pageId:s,sort:t})}}return jsx(Fragment,{children:jsx("div",{className:`contented-dropzone contented-dropzone parent-${r}`,ref:a,style:{height:m?"20px":"0px",display:p?"flex":"none",background:l?"#3b82f6":"#dbeafe",border:l?"1px solid #3b82f6":m?"1px dashed #3b82f6":"",color:l?"white":"#1e40af",alignItems:"center",justifyContent:"center",margin:"2px 0",borderRadius:"4px",overflow:"hidden",transition:"height, display",transitionDuration:"100ms",width:"100%",zIndex:"10"},children:r})})}function ue({index:e,content:o,isParentHovered:r,previousSortKey:s,nextSortKey:t,onDrop:a,pageId:p,parentId:i}){let{cms:m,isEditable:d}=w(),l=useRef(null),y=m.components,[x,M]=useState(!1),[g,D]=useState(!1),[h,P]=useState(!1),{component:N,data:W,children:z$1=[],id:J}=o,[u,he]=useState(W),[G,Q]=useState(!1);useEffect(()=>{let c=I=>{l.current&&!l.current.contains(I.target)&&(P(!1),Q(!1));};return document.addEventListener("click",c,!0),()=>{document.removeEventListener("click",c,!0);}},[]),v(_e,[f,L],z.discriminatedUnion("_action",[S,ae]));function _e(c){var I;if(c.data._action===f){let k=(I=l==null?void 0:l.current)==null?void 0:I.getBoundingClientRect();M(b(k,{x:c.data.x,y:c.data.y})),D(K(k,{x:c.data.x,y:c.data.y},60));}c.data.id===J&&c.data._action===L&&he(k=>({...k,[c.data.field]:c.data.value}));}let ee=y[N].component;if(!d)return jsxs(ee,{...u,children:[u==null?void 0:u.children,z$1&&jsx(Z,{data:z$1,isParentHovered:x,pageId:p,parentId:o.id})]});function ve(){return C({_action:$,page:window.location.href,id:J,component:o.component,data:o.data})}let Me=o.sort-(o.sort-s)/2,De=o.sort+(t-o.sort)/2;return jsxs("div",{style:{position:"relative"},draggable:!0,onDrag:c=>{let I={x:c.pageX,y:c.pageY};return le({_action:f,...I})},children:[e===0&&jsx(O,{isParentHovered:r,onDrop:c=>a&&a(c,e),parentId:i||o.id,pageId:p,sort:Me}),jsxs("div",{ref:l,onMouseOver:c=>(c.stopPropagation(),M(!0)),onMouseOut:c=>(c.stopPropagation(),D(!1),M(!1)),onClick:c=>(c.stopPropagation(),P(!0),ve()),style:{position:"relative",userSelect:"none",border:`1px ${g?"dashed":"solid"} ${(x||h)&&!G?U:g?"rgba(255,255,255,0.2)":"rgb(0,0,0,0)"}`,transition:"all",transitionDuration:(x||h)&&!G?"150ms":"250ms"},children:[(x||h)&&!G&&jsxs("div",{style:{position:"absolute",top:"-25px",left:"5px",borderRadius:"4px",background:U,color:"white",padding:"1px 4px",fontSize:"9pt",fontFamily:"sans-serif",display:"flex",gap:"1rem"},children:[jsx("div",{style:{color:"rgba(255,255,255,0.9)"},children:N}),h&&jsx("button",{type:"button",onClick:c=>(c.stopPropagation(),Q(!0)),children:"Edit"})]}),jsx("div",{children:jsx(ee,{...u,children:z$1&&typeof(u==null?void 0:u.children)!="string"?jsxs(Fragment,{children:[u==null?void 0:u.children,jsx(Z,{data:z$1,isParentHovered:x,pageId:p,parentId:o.id})]}):u==null?void 0:u.children})}),h&&!G&&jsx("button",{type:"button",style:{background:U,borderRadius:"50%",padding:"4px",position:"absolute",bottom:"-15px",right:"10px"},onClick:()=>{console.log("add sibling");},children:jsx(Icon,{icon:"md:add"})})]}),jsx(O,{isParentHovered:r,onDrop:c=>a&&a(c),parentId:i||o.id,pageId:p,sort:De})]})}function me(e){return e.sort((o,r)=>o.sort>r.sort?1:-1)}function Z({data:e,isParentHovered:o,pageId:r,parentId:s}){let[t,a]=useState(me(e));v(p,[A],se,{deps:[t]});function p(i){if(i.data._action===A&&(console.log(i.data,t),t.findIndex(d=>d.id===i.data.id)!==-1))return a(d=>[...d.filter(y=>y.id!==i.data.id)])}return jsx(Fragment,{children:Array.isArray(t)&&(t==null?void 0:t.length)>0?t.map((i,m)=>{var y,x;let d=((y=t[m-1])==null?void 0:y.sort)||i.sort-1e3,l=((x=t[m+1])==null?void 0:x.sort)||i.sort+1e3;return jsx($e.Fragment,{children:jsx(ue,{index:m,content:i,isParentHovered:o,previousSortKey:d,nextSortKey:l,pageId:r,parentId:s,onDrop:(M,g)=>a(D=>(console.log(M),[...me([...D,M])]))})},i.id)}):(t==null?void 0:t.length)>0?t:jsx(O,{isParentHovered:o,pageId:r,parentId:s,sort:0,onDrop:i=>(console.log(i),a([i]))})})}var U="dodgerblue";function ye({data:e}){let{isEditable:o}=w(),r=e.children,[s,t]=useState(!1),[a,p]=useState(!1),i=useRef(null);useEffect(()=>C({_action:"HANDSHAKE",location:{href:window.location.href,pathname:window.location.pathname}}),[]),v(m,[T,f,_],z.discriminatedUnion("_action",[re,S,B]));function m(d){var l;if(d.data._action===T&&t(d.data.isNavigateEnabled),d.data._action===f){let y=(l=i==null?void 0:i.current)==null?void 0:l.getBoundingClientRect();p(b(y,{x:d.data.x,y:d.data.y}));}d.data._action===_&&p(!1);}return console.log(e),jsx(Suspense,{fallback:"Loading...",children:jsxs("div",{ref:i,className:"__adaptivecms__","data-adaptivecms":"page",children:[r&&jsx(Z,{data:r,pageId:e.id,parentId:null}),jsx("style",{type:"text/css",children:s||!o?"":`
            .__adaptivecms__ a {
              pointer-events:none;
            }
          `})]})})}var xe="sk_skr5pte9guegsgk2u7bw92uq";var Ee=class{constructor(o){this.secretApiKey="";this.publicApiKey="";this.components={};this.getPageData=async o=>{let r=new URL(o.url).pathname,s=await fetch(`https://worker.ds-media.workers.dev/?url=${encodeURIComponent(r)}`,{headers:{authorization:`Bearer ${this.publicApiKey}`}}).then(t=>t.status===200?t.json():new Response(null,{status:t.status,statusText:t.statusText}));if(s.status===404)throw new Response(null,{status:s.status,statusText:s.statusText});return s.pageData};if(!o)throw new Error("[CONTENTED] Missing variable: PUBLIC_API_KEY");this.secretApiKey=xe+"",this.publicApiKey=o+"";}define(o,r){let{name:s,deprecated:t=!1,...a}=r;return this.components[s]={component:o,...a},r.schema}sync(){var r;let o=[];(r=Object.keys(this.components))==null||r.map(s=>{let t=this.components[s];o.push({name:s,icon:t==null?void 0:t.icon,schema:oe(t.schema,t.extend),group:t.group});});}};

export { T as ALLOW_NAVIGATE, Ee as C, $ as COMPONENT_SELECTED, F as ContentedProvider, A as DELETE, f as DRAGGING, _ as DROPPED, L as EDIT, st as EventActions, ne as HANDSHAKE, re as MessageEvent_AllowNavigate, se as MessageEvent_Delete, S as MessageEvent_Dragging, B as MessageEvent_Dropped, ae as MessageEvent_Edit, ye as Page, pe as PostMessageSchema, ce as PostMessageSchema_Self, Ce as PostMessage_ComponentSelected, Ne as PostMessage_Dragging, ie as PostMessage_Dropped, be as PostMessage_Handshake, C as postMessage, w as useContented, v as useListener };
